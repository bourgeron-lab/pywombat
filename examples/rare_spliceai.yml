# ============================================================================
# PyWombat Configuration: Rare Splicing Variants (SpliceAI)
# ============================================================================
#
# Filters for variants predicted to affect splicing using SpliceAI scores.
# Combines ultra-rare frequency with high SpliceAI predictions.
#
# Target variants:
#   • Ultra-rare frequency (≤0.1% in gnomAD genomes)
#   • EITHER:
#     a) Pass gnomAD filters with variant-type-specific quality (SNV: AQ>15, INDEL: AQ>22)
#     b) OR high SpliceAI score (≥0.8) predicting splice disruption
#
# SpliceAI interpretation:
#   • maxDS ≥ 0.8: High confidence splice-affecting variant
#   • Predicts donor/acceptor gain/loss across ±50bp window
#   • Validated on known splice-site variants
#
# Usage:
#   uvx pywombat filter input.tsv -F examples/rare_spliceai.yml -o output
#   uvx pywombat filter prepared.parquet -F examples/rare_spliceai.yml -o output
#
# ============================================================================

quality:
  sample_dp_min: 10 # Minimum read depth (coverage)
  sample_gq_min: 19 # Minimum genotype quality score

  # VAF (variant allele frequency) thresholds ensure proper allelic balance
  sample_vaf_het_min: 0.25 # Het (0/1): minimum 25% alternate allele
  sample_vaf_het_max: 0.75 # Het (0/1): maximum 75% to exclude mis-called hom
  sample_vaf_homalt_min: 0.85 # Hom alt (1/1): minimum 85% alternate allele
  sample_vaf_hom_ref_max: 0.15 # Hom ref (0/0): maximum 15% alternate allele

  apply_to_parents: false # Apply same quality filters to parent genotypes
  filter_no_alt_allele: true # Exclude 0/0 and ./. genotypes

  # Uncomment to filter for only homozygous alternative 1/1 variants
  # Useful for recessive disease analysis
  # homalt_only: false

expression: >
  (fafmax_faf95_max_genomes = null | fafmax_faf95_max_genomes <= 0.001) &
  (
    ((is_snv & AQ > 15) | (is_indel & AQ > 22)) &
    genomes_filters is_empty &
    SpliceAI_maxDS not_empty & 
    SpliceAI_maxDS >= 0.8
  )

# ----------------------------------------------------------------------------
# Required Input Columns
# ----------------------------------------------------------------------------
#
# gnomAD v4 annotations:
#   • fafmax_faf95_max_genomes: Filtering allele frequency (95% CI)
#   • genomes_filters: Filter status (empty = PASS)
#
# SpliceAI annotations:
#   • SpliceAI_maxDS: Maximum delta score across all splice predictions
#     - Range: 0-1 (higher = more likely to affect splicing)
#     - Threshold ≥0.8 recommended for high-confidence predictions
#
# Quality metrics:
#   • AQ: Variant quality score
#   • REF/ALT: For is_snv/is_indel predicates
#
# ----------------------------------------------------------------------------
# Customization Tips
# ----------------------------------------------------------------------------
#
# Adjust SpliceAI threshold:
#   • More sensitive: SpliceAI_maxDS >= 0.5
#   • More stringent: SpliceAI_maxDS >= 0.9
#
# Adjust frequency threshold:
#   • More variants: fafmax_faf95_max_genomes <= 0.01 (1%)
#   • Stricter: fafmax_faf95_max_genomes <= 0.0001 (0.01%)
#
# Include specific splice predictions:
#   • Add: & (SpliceAI_AG_loss >= 0.8 | SpliceAI_DG_loss >= 0.8)
#   • This focuses on acceptor/donor losses specifically
#
# ============================================================================
